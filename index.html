<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Cosmic Presence</title>

<style>
html,body{
 margin:0;
 background:black;
 overflow:hidden;
 font-family:system-ui;
}
canvas{position:fixed;top:0;left:0;}
#halo{
 position:fixed;
 bottom:20%;
 left:50%;
 transform:translateX(-50%);
 width:24px;height:24px;
 border-radius:50%;
 background:#6ff;
 box-shadow:0 0 30px #6ff;
 opacity:0;
 transition:.3s;
}
#text{
 position:fixed;
 top:45%;
 width:100%;
 text-align:center;
 font-size:clamp(28px,7vw,64px);
 color:white;
 letter-spacing:4px;
 opacity:0;
 transition:1.5s;
}
video{
 position:fixed;
 bottom:12px;
 right:12px;
 width:120px;
 border-radius:12px;
 opacity:.85;
 transform:scaleX(-1);
}
</style>
</head>

<body>
<canvas id="bg"></canvas>
<div id="halo"></div>
<div id="text">AKU MELIHATMU</div>
<video id="cam" autoplay playsinline></video>

<script>
const video=document.getElementById("cam");
navigator.mediaDevices.getUserMedia({video:true}).then(s=>video.srcObject=s);

const c=document.getElementById("bg");
const ctx=c.getContext("2d");
c.width=innerWidth;
c.height=innerHeight;

const stars=[...Array(350)].map(()=>({
 x:Math.random()*c.width,
 y:Math.random()*c.height,
 r:Math.random()*1.5,
 vx:(Math.random()-.5)*0.2,
 vy:(Math.random()-.5)*0.2,
 c:`hsl(${200+Math.random()*120},100%,70%)`
}));

function draw(){
 ctx.clearRect(0,0,c.width,c.height);
 stars.forEach(s=>{
  s.x+=s.vx; s.y+=s.vy;
  if(s.x<0)s.x=c.width;
  if(s.y<0)s.y=c.height;
  ctx.fillStyle=s.c;
  ctx.beginPath();
  ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
  ctx.fill();
 });
 requestAnimationFrame(draw);
}
draw();

// === MOTION DETECTION ===
const off=document.createElement("canvas");
const offCtx=off.getContext("2d");
off.width=160; off.height=120;

let last=null;
let motionFrames=0;
let triggered=false;

setInterval(()=>{
 if(video.videoWidth===0)return;
 offCtx.drawImage(video,0,0,off.width,off.height);
 const data=offCtx.getImageData(0,0,off.width,off.height).data;
 if(last){
  let diff=0;
  for(let i=0;i<data.length;i+=4){
   diff+=Math.abs(data[i]-last[i]);
  }
  if(diff>300000){
    motionFrames++;
    document.getElementById("halo").style.opacity=1;
    if(motionFrames>5 && !triggered){
      triggered=true;
      document.getElementById("text").style.opacity=1;
      stars.forEach(s=>{
        s.vx=(c.width/2-s.x)/120;
        s.vy=(c.height/2-s.y)/120;
      });
    }
  }else{
    motionFrames=0;
    document.getElementById("halo").style.opacity=0;
  }
 }
 last=data;
},200);
</script>
</body>
</html>
