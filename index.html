<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cosmic Gesture – Stable</title>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display&display=swap" rel="stylesheet">

<style>
html,body{
 margin:0;
 padding:0;
 background:black;
 overflow:hidden;
 font-family:'Playfair Display',serif;
}
#container{position:fixed;inset:0}
#hud{
 position:fixed;
 top:10px;
 left:50%;
 transform:translateX(-50%);
 color:#fff;
 font-size:13px;
 opacity:.8;
 z-index:10;
}
#cam{
 position:fixed;
 bottom:12px;
 right:12px;
 width:120px;
 height:160px;
 border-radius:14px;
 overflow:hidden;
 border:1px solid rgba(255,255,255,.4);
 z-index:10;
}
#cam video{
 width:100%;
 height:100%;
 object-fit:cover;
 transform:scaleX(-1);
}
#start{
 position:fixed;
 inset:0;
 background:radial-gradient(circle,#220033,#000);
 display:flex;
 align-items:center;
 justify-content:center;
 z-index:20;
 color:#fff;
 text-align:center;
}
#start button{
 padding:14px 32px;
 font-size:18px;
 border-radius:40px;
 border:none;
}
</style>
</head>
<body>

<div id="container"></div>
<div id="hud">Loading model…</div>

<div id="cam"><video id="video" playsinline></video></div>

<div id="start">
 <div>
  <h2>✨ Tap to Start ✨</h2>
  <p>Allow camera</p>
  <button>Start</button>
 </div>
</div>

<!-- THREE -->
<script src="https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.min.js"></script>

<!-- TFJS -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/handpose@0.0.7/dist/handpose.min.js"></script>

<script>
/* ================= THREE ================= */
const scene=new THREE.Scene();
scene.fog=new THREE.FogExp2(0x050010,0.0012);

const camera=new THREE.PerspectiveCamera(60,innerWidth/innerHeight,1,3000);
camera.position.z=520;

const renderer=new THREE.WebGLRenderer({antialias:false});
renderer.setPixelRatio(Math.min(devicePixelRatio,1.5));
renderer.setSize(innerWidth,innerHeight);
document.getElementById("container").appendChild(renderer.domElement);

/* ================= PARTICLES ================= */
const IS_MOBILE=/Android|iPhone/i.test(navigator.userAgent);
const COUNT=IS_MOBILE?1600:3600;

const geo=new THREE.BufferGeometry();
const pos=new Float32Array(COUNT*3);
const base=new Float32Array(COUNT*3);
const target=new Float32Array(COUNT*3);

for(let i=0;i<COUNT;i++){
 base[i*3]=(Math.random()-0.5)*1800;
 base[i*3+1]=(Math.random()-0.5)*1800;
 base[i*3+2]=(Math.random()-0.5)*1800;
 pos.set(base);
 target.set(base);
}
geo.setAttribute("position",new THREE.BufferAttribute(pos,3));

const stars=new THREE.Points(geo,new THREE.PointsMaterial({
 size:IS_MOBILE?2.3:1.8,
 color:0xffffff,
 transparent:true,
 opacity:.95,
 blending:THREE.AdditiveBlending
}));
scene.add(stars);

/* ================= 3D TEXT ================= */
let textMesh=null;
const loader=new THREE.FontLoader();
let font=null;

loader.load(
 "https://cdn.jsdelivr.net/npm/three@0.155.0/examples/fonts/helvetiker_regular.typeface.json",
 f=>font=f
);

function showText3D(txt,color){
 if(!font)return;
 if(textMesh)scene.remove(textMesh);

 const geo=new THREE.TextGeometry(txt,{
  font,
  size:28,
  height:10,
  curveSegments:8
 });
 geo.center();

 const mat=new THREE.MeshStandardMaterial({
  color,
  emissive:color,
  emissiveIntensity:0.6
 });

 textMesh=new THREE.Mesh(geo,mat);
 scene.add(textMesh);
}

/* ================= LIGHT ================= */
scene.add(new THREE.AmbientLight(0xffffff,.6));
const l=new THREE.PointLight(0xff88ff,1.2);
l.position.set(200,200,300);
scene.add(l);

/* ================= ANIMATE ================= */
let blend=0,goal=0;
function animate(){
 requestAnimationFrame(animate);
 blend+=(goal-blend)*0.02;

 const p=geo.attributes.position.array;
 for(let i=0;i<COUNT;i++){
  p[i*3]=base[i*3]+(target[i*3]-base[i*3])*blend;
  p[i*3+1]=base[i*3+1]+(target[i*3+1]-base[i*3+1])*blend;
  p[i*3+2]=base[i*3+2]+(target[i*3+2]-base[i*3+2])*blend;
 }
 geo.attributes.position.needsUpdate=true;

 stars.rotation.y+=0.0004;
 renderer.render(scene,camera);
}
animate();

/* ================= HANDPOSE ================= */
let model=null;
const video=document.getElementById("video");
const hud=document.getElementById("hud");

async function detect(){
 if(!model)return;
 const pred=await model.estimateHands(video,false);
 if(pred.length){
  hud.textContent="Hand detected";
  handleGesture(pred[0].landmarks);
 }else{
  hud.textContent="Searching hand…";
  goal=0;
 }
 requestAnimationFrame(detect);
}

function handleGesture(lm){
 const up=(a,b)=>lm[a][1]<lm[b][1];
 let f=0;
 if(up(8,6))f++;
 if(up(12,10))f++;
 if(up(16,14))f++;
 if(up(20,18))f++;

 goal=1;
 if(f===1)showText3D("Dear Laily Aliyah",0xffa6c9);
 if(f===2)showText3D("I never meant to hurt you",0xa6d8ff);
 if(f===3)showText3D("I'm truly sorry",0xffd27d);
 if(f===4)showText3D("♥",0xff4b6e);
 if(f===5)showText3D("ilysm ly ♥",0xbaffc9);
 if(f===0)showText3D("from: Raja Iblis",0xffffff);
}

/* ================= START ================= */
document.querySelector("#start button").onclick=async()=>{
 document.getElementById("start").style.display="none";

 const stream=await navigator.mediaDevices.getUserMedia({
  video:{facingMode:"user"}
 });
 video.srcObject=stream;
 await video.play();

 model=await handpose.load();
 hud.textContent="Model ready";
 detect();
};
</script>
</body>
</html>
