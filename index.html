<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>For Laily</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Playfair+Display:wght@500&display=swap" rel="stylesheet">

<style>
html,body{
  margin:0;
  padding:0;
  background:black;
  overflow:hidden;
  font-family:'Playfair Display',serif;
}

canvas{ position:fixed; inset:0 }

#start{
  position:fixed;
  inset:0;
  background:radial-gradient(circle at center,#140028,#000);
  display:flex;
  align-items:center;
  justify-content:center;
  color:white;
  font-size:16px;
  letter-spacing:2px;
  z-index:20;
}

#camera{
  position:fixed;
  right:12px;
  bottom:12px;
  width:130px;
  height:180px;
  border-radius:14px;
  overflow:hidden;
  border:1px solid rgba(255,255,255,.4);
  backdrop-filter:blur(6px);
  display:none;
  z-index:10;
}

#camera::after{
  content:"place your hand here";
  position:absolute;
  bottom:4px;
  width:100%;
  text-align:center;
  font-size:9px;
  color:white;
  opacity:.7;
}

video{
  width:100%;
  height:100%;
  object-fit:cover;
  transform:scaleX(-1);
}

audio{display:none}
</style>
</head>

<body>

<div id="start">TOUCH TO BEGIN</div>
<div id="camera"><video id="video" autoplay muted playsinline></video></div>

<audio id="music" loop>
  <source src="https://cdn.pixabay.com/audio/2022/03/15/audio_4b06c6a2c3.mp3">
</audio>

<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<script>
/* =====================
   THREE SCENE
===================== */
const scene=new THREE.Scene();
const cam3d=new THREE.PerspectiveCamera(60,innerWidth/innerHeight,1,4000);
cam3d.position.z=900;

const renderer=new THREE.WebGLRenderer({alpha:true,antialias:true});
renderer.setSize(innerWidth,innerHeight);
renderer.setPixelRatio(Math.min(devicePixelRatio,2));
document.body.appendChild(renderer.domElement);

/* Stars */
const starsGeo=new THREE.BufferGeometry();
const count=3500;
const arr=[];
for(let i=0;i<count;i++){
  arr.push(
    (Math.random()-0.5)*3000,
    (Math.random()-0.5)*2000,
    (Math.random()-0.5)*3000
  );
}
starsGeo.setAttribute("position",new THREE.Float32BufferAttribute(arr,3));
const stars=new THREE.Points(starsGeo,new THREE.PointsMaterial({
  color:0xffffff,
  size:2,
  transparent:true,
  opacity:0.6
}));
scene.add(stars);

/* Light */
scene.add(new THREE.AmbientLight(0x7755ff,0.6));
const glow=new THREE.PointLight(0xaa88ff,1.2,2500);
glow.position.set(0,0,500);
scene.add(glow);

/* =====================
   TEXT PARTICLES
===================== */
let message=null;
function showMessage(text){
  if(message) scene.remove(message);

  const c=document.createElement("canvas");
  c.width=1800; c.height=500;
  const ctx=c.getContext("2d");
  ctx.fillStyle="white";
  ctx.textAlign="center";
  ctx.font="70px Great Vibes";

  const words=text.split(" ");
  let line="";
  let y=200;
  for(let i=0;i<words.length;i++){
    if((line+words[i]).length>35){
      ctx.fillText(line,c.width/2,y);
      line=""; y+=90;
    }
    line+=words[i]+" ";
  }
  ctx.fillText(line,c.width/2,y);

  const data=ctx.getImageData(0,0,c.width,c.height).data;
  const geo=new THREE.BufferGeometry();
  const pos=[];
  for(let y2=0;y2<c.height;y2+=4){
    for(let x=0;x<c.width;x+=4){
      const i=(y2*c.width+x)*4;
      if(data[i+3]>150){
        pos.push(
          (x-c.width/2)*0.8,
          (c.height/2-y2)*0.8,
          0
        );
      }
    }
  }
  geo.setAttribute("position",new THREE.Float32BufferAttribute(pos,3));
  message=new THREE.Points(geo,new THREE.PointsMaterial({
    color:0xffffff,
    size:2,
    transparent:true,
    opacity:1
  }));
  scene.add(message);
}

/* =====================
   GESTURE MAP
===================== */
const texts={
  1:"Dear Laily Aliyah, I want to sincerely apologize for everything that happened.",
  2:"I never intended to deceive you or break your trust. My words were honest.",
  3:"I’m truly sorry for the misunderstanding and the pain it caused.",
  4:"♥",
  5:"ilysm ly ♥",
  0:"from: Raja Iblis"
};

let last=-1,hold=0;

/* =====================
   MEDIAPIPE
===================== */
const hands=new Hands({
  locateFile:f=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`
});
hands.setOptions({
  maxNumHands:1,
  modelComplexity:1,
  minDetectionConfidence:0.7,
  minTrackingConfidence:0.7
});

hands.onResults(r=>{
  if(!r.multiHandLandmarks.length){
    if(message){
      message.material.opacity*=0.97;
      if(message.material.opacity<0.05){
        scene.remove(message);
        message=null;
      }
    }
    last=-1;
    return;
  }

  const lm=r.multiHandLandmarks[0];
  const tips=[4,8,12,16,20];
  let c=0;
  for(let i=1;i<5;i++) if(lm[tips[i]].y<lm[tips[i]-2].y)c++;
  if(lm[4].x<lm[3].x)c++;

  if(c!==last){hold=0;last=c;return;}
  hold++;
  if(hold>18 && texts[c]) showMessage(texts[c]);
});

/* =====================
   START
===================== */
const video=document.getElementById("video");
const cam=new Camera(video,{
  onFrame:async()=>hands.send({image:video}),
  width:640,height:480
});

document.getElementById("start").onclick=()=>{
  document.getElementById("start").remove();
  document.getElementById("camera").style.display="block";
  document.getElementById("music").play();
  cam.start();
};

/* =====================
   LOOP
===================== */
function animate(){
  requestAnimationFrame(animate);
  stars.rotation.y+=0.0004;
  cam3d.position.x=Math.sin(Date.now()*0.00008)*20;
  renderer.render(scene,cam3d);
}
animate();

addEventListener("resize",()=>{
  cam3d.aspect=innerWidth/innerHeight;
  cam3d.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>
