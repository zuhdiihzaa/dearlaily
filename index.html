<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>For Laily</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Playfair+Display:wght@500&display=swap" rel="stylesheet">

<style>
html,body{
  margin:0;
  padding:0;
  background:black;
  overflow:hidden;
  font-family:'Playfair Display',serif;
}

canvas{ position:fixed; inset:0 }

#start{
  position:fixed;
  inset:0;
  background:radial-gradient(circle at center,#1a0033,#000);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  color:white;
  font-size:16px;
  letter-spacing:2px;
  z-index:20;
}

#start small{
  margin-top:16px;
  font-size:11px;
  opacity:0.6;
}

#cameraBox{
  position:fixed;
  top:10px;
  left:50%;
  transform:translateX(-50%);
  width:120px;
  height:160px;
  border-radius:14px;
  overflow:hidden;
  border:1px solid rgba(255,255,255,0.4);
  backdrop-filter:blur(6px);
  display:none;
  z-index:10;
}

#cameraBox::after{
  content:"let your hand rest here";
  position:absolute;
  bottom:4px;
  width:100%;
  text-align:center;
  font-size:9px;
  color:white;
  opacity:0.7;
}

video{
  width:100%;
  height:100%;
  object-fit:cover;
  transform:scaleX(-1);
}

audio{display:none}
</style>
</head>

<body>

<div id="start">
  TOUCH TO BEGIN
  <small id="noCam">Continue without camera</small>
</div>

<div id="cameraBox"><video id="video" autoplay muted playsinline></video></div>

<audio id="music" loop>
  <source src="https://cdn.pixabay.com/audio/2022/03/15/audio_4b06c6a2c3.mp3">
</audio>

<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<script>
/* =====================
   SCENE
===================== */
const scene=new THREE.Scene();
const cam3d=new THREE.PerspectiveCamera(65,innerWidth/innerHeight,1,4000);
cam3d.position.z=900;

const renderer=new THREE.WebGLRenderer({alpha:true,antialias:true});
renderer.setSize(innerWidth,innerHeight);
renderer.setPixelRatio(Math.min(devicePixelRatio,2));
document.body.appendChild(renderer.domElement);

/* Stars */
const starCount=2600;
const geo=new THREE.BufferGeometry();
const pos=[];
for(let i=0;i<starCount;i++){
  pos.push(
    (Math.random()-0.5)*2000,
    (Math.random()-0.5)*3000,
    (Math.random()-0.5)*2000
  );
}
geo.setAttribute("position",new THREE.Float32BufferAttribute(pos,3));
const stars=new THREE.Points(geo,new THREE.PointsMaterial({
  color:0xffffff,
  size:2,
  transparent:true,
  opacity:0.6
}));
scene.add(stars);
scene.add(new THREE.AmbientLight(0x7755ff,0.6));

/* =====================
   TEXT WORD BY WORD
===================== */
let mesh=null,interval=null;
function showTextSlow(text){
  if(mesh) scene.remove(mesh);
  clearInterval(interval);

  const words=text.split(" ");
  let current=[];

  interval=setInterval(()=>{
    if(current.length>=words.length){
      clearInterval(interval);
      return;
    }
    current.push(words[current.length]);
    drawText(current.join(" "));
  },700);
}

function drawText(txt){
  if(mesh) scene.remove(mesh);
  const c=document.createElement("canvas");
  c.width=1000;c.height=900;
  const ctx=c.getContext("2d");
  ctx.fillStyle="white";
  ctx.textAlign="center";
  ctx.font="60px Great Vibes";

  let y=220,line="";
  txt.split(" ").forEach(w=>{
    if((line+w).length>18){
      ctx.fillText(line,c.width/2,y);
      line="";y+=90;
    }
    line+=w+" ";
  });
  ctx.fillText(line,c.width/2,y);

  const data=ctx.getImageData(0,0,c.width,c.height).data;
  const g=new THREE.BufferGeometry();
  const p=[];
  for(let y2=0;y2<c.height;y2+=4){
    for(let x=0;x<c.width;x+=4){
      const i=(y2*c.width+x)*4;
      if(data[i+3]>150){
        p.push((x-c.width/2)*1.2,(c.height/2-y2)*1.2,0);
      }
    }
  }
  g.setAttribute("position",new THREE.Float32BufferAttribute(p,3));
  mesh=new THREE.Points(g,new THREE.PointsMaterial({color:0xffffff,size:2,transparent:true,opacity:1}));
  scene.add(mesh);
}

/* =====================
   SEQUENCE (NO CAMERA)
===================== */
const sequence=[
  "Dear Laily Aliyah, I want to sincerely apologize for everything that happened.",
  "I never intended to deceive you or break your trust.",
  "I am truly sorry for the misunderstanding and the pain it caused.",
  "ilysm ly â™¥",
  "from: Raja Iblis"
];

function playSequence(){
  let i=0;
  const next=()=>{
    if(i>=sequence.length)return;
    showTextSlow(sequence[i]);
    i++;
    setTimeout(next,6000);
  };
  next();
}

/* =====================
   CAMERA MODE
===================== */
const hands=new Hands({
  locateFile:f=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`
});
hands.setOptions({maxNumHands:1,minDetectionConfidence:.65,minTrackingConfidence:.65});

hands.onResults(r=>{
  if(!r.multiHandLandmarks.length)return;
  showTextSlow(sequence[0]);
});

/* =====================
   START
===================== */
const video=document.getElementById("video");
const cam=new Camera(video,{onFrame:async()=>hands.send({image:video}),width:640,height:480});

document.getElementById("start").onclick=()=>{
  document.getElementById("start").remove();
  document.getElementById("cameraBox").style.display="block";
  document.getElementById("music").play();
  cam.start();
};

document.getElementById("noCam").onclick=e=>{
  e.stopPropagation();
  document.getElementById("start").remove();
  document.getElementById("music").play();
  playSequence();
};

/* =====================
   LOOP
===================== */
function animate(){
  requestAnimationFrame(animate);
  stars.rotation.y+=0.0002;
  renderer.render(scene,cam3d);
}
animate();

addEventListener("resize",()=>{
  cam3d.aspect=innerWidth/innerHeight;
  cam3d.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>

</body>
</html>
