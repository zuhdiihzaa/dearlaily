<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Cosmic Letter</title>

<style>
html,body{
  margin:0;
  background:black;
  overflow:hidden;
  font-family: "Georgia", serif;
}

#space{
  position:fixed;
  inset:0;
  background:
    radial-gradient(circle at 30% 40%, rgba(120,80,255,.25), transparent 60%),
    radial-gradient(circle at 70% 60%, rgba(255,120,200,.2), transparent 55%),
    radial-gradient(circle at 50% 50%, rgba(255,200,120,.15), transparent 65%),
    black;
  animation: drift 40s linear infinite;
}

@keyframes drift{
  0%{background-position:0 0}
  100%{background-position:400px 200px}
}

#stars{
  position:fixed;
  inset:0;
  background-image:
    radial-gradient(white 1px, transparent 1px),
    radial-gradient(white 1px, transparent 1px);
  background-size: 3px 3px, 5px 5px;
  background-position: 0 0, 50px 80px;
  opacity:.5;
  animation: twinkle 6s ease-in-out infinite alternate;
}

@keyframes twinkle{
  from{opacity:.4}
  to{opacity:.7}
}

#text{
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:24px;
  text-align:center;
  color:white;
  font-size:clamp(18px,4.5vw,34px);
  line-height:1.6;
  text-shadow:
    0 0 20px rgba(255,255,255,.35),
    0 0 60px rgba(200,150,255,.25);
}

video{
  position:fixed;
  bottom:12px;
  right:12px;
  width:120px;
  border-radius:14px;
  opacity:.75;
  transform:scaleX(-1);
}
</style>
</head>
<body>

<div id="space"></div>
<div id="stars"></div>
<div id="text"></div>
<video id="cam" autoplay playsinline></video>

<script>
/* ===== CAMERA ===== */
const video = document.getElementById("cam");
navigator.mediaDevices.getUserMedia({video:true})
.then(s=>video.srcObject=s);

/* ===== TYPEWRITER ===== */
const textBox = document.getElementById("text");
let typing=false;

function typeText(str){
  if(typing) return;
  typing=true;
  textBox.innerHTML="";
  let i=0;
  const t=setInterval(()=>{
    textBox.innerHTML += str[i] || "";
    i++;
    if(i>=str.length){
      clearInterval(t);
      typing=false;
    }
  },35);
}

/* ===== MESSAGES ===== */
const MSG_OPEN = `Dear Laily Aliyah,

I want to sincerely apologize for the situation that happened.
I’m truly sorry if everything made you feel disappointed,
confused, or hurt.

I never intended to deceive you.
My words were honest from the beginning,
and they came from a sincere place.`;

const MSG_FIST = `I’m really sorry for the misunderstanding.

ilysm ly ♥
from: Raja Iblis`;

/* ===== MOTION DETECTION (STABLE) ===== */
const off=document.createElement("canvas");
const ctx=off.getContext("2d");
off.width=160; off.height=120;

let last=null;
let stable=0;
let mode="none";

setInterval(()=>{
  if(video.videoWidth===0) return;
  ctx.drawImage(video,0,0,off.width,off.height);
  const d=ctx.getImageData(0,0,off.width,off.height).data;

  if(last){
    let diff=0;
    for(let i=0;i<d.length;i+=4){
      diff+=Math.abs(d[i]-last[i]);
    }

    if(diff>220000){
      stable++;
      if(stable>6){
        const newMode = diff>350000 ? "open" : "fist";
        if(newMode!==mode){
          mode=newMode;
          if(mode==="open") typeText(MSG_OPEN);
          if(mode==="fist") typeText(MSG_FIST);
        }
      }
    }else{
      stable=0;
    }
  }
  last=d;
},200);
</script>

</body>
</html>
